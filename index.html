<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>V16.8 VENDOR PRO - FIRDAUS WISATA</title>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        :root { --gold: #C5A059; --bg: #050505; --card: #111111; --input: #1A1A1A; --text: #FFFFFF; --text-dim: #888888; --danger: #FF4D4D; --success: #00FF94; }
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Plus Jakarta Sans', sans-serif; }
        body { background: var(--bg); color: var(--text); padding-bottom: 120px; }
        .finance-header { background: linear-gradient(180deg, #1A1A1A 0%, #050505 100%); padding: 20px; border-bottom: 1px solid #222; position: sticky; top: 0; z-index: 100; backdrop-filter: blur(15px); }
        .main-balance h1 { font-size: 22px; font-weight: 800; color: var(--gold); text-align: center; }
        .stat-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 15px; }
        .stat-box { background: var(--card); padding: 10px; border-radius: 12px; border: 1px solid #222; }
        .stat-box p { font-size: 7px; color: var(--text-dim); font-weight: 800; text-transform: uppercase; }
        .screen { display: none; padding: 0 20px; animation: fadeIn 0.3s ease; }
        .screen.active { display: block; }
        .glass-card { background: var(--card); border: 1px solid #222; border-radius: 20px; padding: 18px; margin-bottom: 15px; }
        label { font-size: 7px; color: var(--gold); font-weight: 800; text-transform: uppercase; margin-bottom: 4px; display: block; }
        input { background: var(--input); border: 1px solid #333; padding: 10px; border-radius: 8px; color: white; font-size: 12px; width: 100%; }
        .row-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; margin-bottom: 10px; }
        .room-section { background: #000; padding: 15px; border-radius: 12px; border: 1px solid #222; margin-bottom: 15px; }
        .room-title { font-size: 10px; font-weight: 800; color: var(--gold); margin-bottom: 10px; border-bottom: 1px solid #222; padding-bottom: 5px; }
        .bottom-nav { position: fixed; bottom: 0; width: 100%; background: rgba(0,0,0,0.95); display: flex; border-top: 1px solid #222; z-index: 1000; padding: 15px 0; }
        .nav-item { flex: 1; text-align: center; color: var(--text-dim); font-size: 9px; font-weight: 700; cursor: pointer; }
        .nav-item.active { color: var(--gold); }
        .btn-print { width: 100%; padding: 18px; border-radius: 16px; background: var(--gold); color: #000; font-weight: 800; border: none; margin-top: 5px; cursor: pointer; }
    </style>
</head>
<body>

<div id="mainApp">
    <div class="finance-header">
        <div class="main-balance">
            <p style="font-size:8px; color:var(--text-dim); text-align:center;">LABA BERSIH ESTIMASI (FWI)</p>
            <h1 id="topProfit">Rp 0</h1>
        </div>
        <div class="stat-grid">
            <div class="stat-box"><p>Omzet</p><h2 id="topRev" style="font-size:12px;">0</h2></div>
            <div class="stat-box"><p>Total Modal (HPP)</p><h2 id="topHpp" style="font-size:12px;">0</h2></div>
        </div>
    </div>

    <div id="screen-finance" class="screen active">
        <div class="glass-card" style="margin-top:20px">
            <label>1. BIAYA TETAP PER PAX (IDR/SAR/USD)</label>
            <div class="row-grid">
                <div><label>Tiket Pesawat</label><input type="number" id="tk" value="14500000" oninput="calcAll()"></div>
                <div><label>Visa (USD)</label><input type="number" id="vs" value="185" oninput="calcAll()"></div>
            </div>
            <div class="row-grid">
                <div><label>Kurs USD</label><input type="number" id="ku" value="15900" oninput="calcAll()"></div>
                <div><label>Kurs SAR</label><input type="number" id="ks" value="4350" oninput="calcAll()"></div>
            </div>
            <div class="row-grid">
                <div><label>Handling + Perlkp</label><input type="number" id="hp" value="1500000" oninput="calcAll()"></div>
                <div><label>LA / Kereta / Asu</label><input type="number" id="la" value="1500000" oninput="calcAll()"></div>
            </div>
        </div>

        <div class="glass-card">
            <label>2. DURASI HOTEL (MALAM)</label>
            <div class="row-grid">
                <div><label>Malam Makkah</label><input type="number" id="nMek" value="5" oninput="calcAll()"></div>
                <div><label>Malam Madinah</label><input type="number" id="nMad" value="4" oninput="calcAll()"></div>
            </div>
        </div>

        <div id="activePackageEditor"></div>
        <button class="btn-print" onclick="generatePDF()">DOWNLOAD PENAWARAN (PDF)</button>
    </div>

    <div id="screen-inventory" class="screen">
        <h3 style="color:var(--gold); font-size:11px; margin: 20px 0 10px 0;">MANIFEST JEMAAH</h3>
        <div id="roomList"></div>
        <button onclick="addRoom()" style="background:none; border:1px dashed var(--gold); color:var(--gold); padding:12px; border-radius:12px; width:100%; font-size:11px; font-weight:800;">+ TAMBAH UNIT</button>
    </div>

    <div class="bottom-nav">
        <div class="nav-item active" id="nav-f" onclick="setTab('finance')">PRICING</div>
        <div class="nav-item" id="nav-i" onclick="setTab('inventory')">MANIFEST</div>
    </div>
</div>

<script>
    let p = JSON.parse(localStorage.getItem('fwi_v16_8_p')) || {
        // Harga Sewa Per Room Per Malam (Vendor)
        vMekQ: 2000, vMekT: 2400, vMekD: 2800,
        vMadQ: 1600, vMadT: 1900, vMadD: 2300,
        // HPP, Profit, Jual
        hQ: 0, hT: 0, hD: 0,
        profQ: 3000000, profT: 3500000, profD: 4000000,
        jQ: 0, jT: 0, jD: 0
    };
    let rooms = JSON.parse(localStorage.getItem('fwi_v16_8_r')) || [{ type: 'Q', pax: 4 }];

    function setTab(t) {
        document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
        document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
        document.getElementById('screen-'+t).classList.add('active');
        document.getElementById('nav-'+t.charAt(0)).classList.add('active');
    }

    function updateP(key, val, trigger) {
        p[key] = parseFloat(val) || 0;
        calcAll(trigger);
    }

    function addRoom() { rooms.push({ type:'Q', pax:4 }); calcAll(); }
    function updateRoom(i, f, v) { rooms[i][f] = (f === 'pax') ? parseInt(v) : v; calcAll(); }

    function calcAll(trigger) {
        const kS = parseFloat(document.getElementById('ks').value) || 0;
        const kU = parseFloat(document.getElementById('ku').value) || 0;
        const fixPax = (parseFloat(document.getElementById('tk').value) || 0) + 
                       ((parseFloat(document.getElementById('vs').value) || 0) * kU) + 
                       (parseFloat(document.getElementById('hp').value) || 0) + 
                       (parseFloat(document.getElementById('la').value) || 0);
        
        const nM = parseFloat(document.getElementById('nMek').value) || 0;
        const nD = parseFloat(document.getElementById('nMad').value) || 0;

        // HITUNG OTOMATIS BERDASARKAN HARGA PER ROOM VENDOR
        const autoHQ = fixPax + ( ((p.vMekQ * nM) + (p.vMadQ * nD)) / 4 ) * kS;
        const autoHT = fixPax + ( ((p.vMekT * nM) + (p.vMadT * nD)) / 3 ) * kS;
        const autoHD = fixPax + ( ((p.vMekD * nM) + (p.vMadD * nD)) / 2 ) * kS;

        if(!trigger || trigger === 'vendor') {
            p.hQ = autoHQ; p.hT = autoHT; p.hD = autoHD;
            p.jQ = p.hQ + p.profQ; p.jT = p.hT + p.profT; p.jD = p.hD + p.profD;
        } else if(trigger === 'hpp' || trigger === 'prof') {
            p.jQ = p.hQ + p.profQ; p.jT = p.hT + p.profT; p.jD = p.hD + p.profD;
        } else if(trigger === 'jual') {
            p.profQ = p.jQ - p.hQ; p.profT = p.jT - p.hT; p.profD = p.jD - p.hD;
        }

        renderPricing();
        renderManifest();
        localStorage.setItem('fwi_v16_8_p', JSON.stringify(p));
        localStorage.setItem('fwi_v16_8_r', JSON.stringify(rooms));
    }

    function renderPricing() {
        document.getElementById('activePackageEditor').innerHTML = `
            <div class="glass-card">
                <label>3. HARGA VENDOR PER ROOM & HARGA JUAL PER PAX</label>
                ${renderRoomBlock('QUAD', 'Q', 4)}
                ${renderRoomBlock('TRIPLE', 'T', 3)}
                ${renderRoomBlock('DOUBLE', 'D', 2)}
            </div>`;
    }

    function renderRoomBlock(label, key, cap) {
        return `
            <div class="room-section">
                <div class="room-title">PAKET ${label} (Ber-${cap})</div>
                <div class="row-grid">
                    <div><label>Mekkah (Room/Night)</label><input type="number" value="${p['vMek'+key]}" oninput="updateP('vMek${key}', this.value, 'vendor')"></div>
                    <div><label>Madinah (Room/Night)</label><input type="number" value="${p['vMad'+key]}" oninput="updateP('vMad${key}', this.value, 'vendor')"></div>
                </div>
                <div class="row-grid" style="border-top: 1px solid #222; padding-top:10px; margin-top:5px">
                    <div><label>HPP IDR (Editable)</label><input type="number" style="background:#222" value="${Math.round(p['h'+key])}" oninput="updateP('h${key}', this.value, 'hpp')"></div>
                    <div><label>Profit IDR</label><input type="number" style="color:var(--success)" value="${Math.round(p['prof'+key])}" oninput="updateP('prof${key}', this.value, 'prof')"></div>
                </div>
                <div><label>HARGA JUAL JEMAAH</label><input type="number" style="color:var(--gold); font-weight:800; font-size:14px" value="${Math.round(p['j'+key])}" oninput="updateP('j${key}', this.value, 'jual')"></div>
            </div>`;
    }

    function renderManifest() {
        let tRev = 0, tHpp = 0;
        const rDiv = document.getElementById('roomList'); rDiv.innerHTML = "";
        rooms.forEach((r, i) => {
            const h = r.type==='Q'?p.hQ:(r.type==='T'?p.hT:p.hD);
            const j = r.type==='Q'?p.jQ:(r.type==='T'?p.jT:p.jD);
            tRev += (j * r.pax); tHpp += (h * r.pax);
            rDiv.innerHTML += `
                <div class="glass-card" style="margin-bottom:10px; display:flex; justify-content:space-between; align-items:center;">
                    <span>Unit ${i+1}</span>
                    <select onchange="updateRoom(${i},'type',this.value)" style="background:#000; color:#fff; padding:5px; border:1px solid #444">
                        <option value="Q" ${r.type=='Q'?'selected':''}>QUAD</option>
                        <option value="T" ${r.type=='T'?'selected':''}>TRIP</option>
                        <option value="D" ${r.type=='D'?'selected':''}>DBL</option>
                    </select>
                    <input type="number" style="width:50px" value="${r.pax}" oninput="updateRoom(${i},'pax',this.value)">
                </div>`;
        });
        document.getElementById('topProfit').innerText = fmt(tRev - tHpp);
        document.getElementById('topRev').innerText = fmt(tRev);
        document.getElementById('topHpp').innerText = fmt(tHpp);
    }

    function fmt(v) { return new Intl.NumberFormat('id-ID',{style:'currency',currency:'IDR',maximumFractionDigits:0}).format(v); }
    function generatePDF() { /* Logic PDF Sama */ alert("PDF Generated for Firdaus Wisata"); }
    window.onload = () => calcAll();
</script>
</body>
</html>
